<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>簽到系統</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: '微軟正黑體', sans-serif;
        background: #f5f8ff;
        text-align: center;
        margin: 0;
        padding: 2rem;
    }
    h2 {
        color: #2b4b8a;
    }
    input[type="text"] {
        font-size: 20px;
        padding: 10px;
        width: 250px;
        border: 2px solid #ccc;
        border-radius: 8px;
    }
    input[type="button"] {
        padding: 8px 16px;
        font-size: 16px;
        background-color: #2b4b8a;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    input[type="button"]:hover {
        background-color: #3c5cad;
    }
    textarea {
        font-size: 16px;
        width: 100%;
        max-width: 400px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #aaa;
        padding: 10px;
        resize: none;
    }
    #who_check {
        height: 120px;
        font-size: 36pt;
        font-weight: bold;
        color: #2b4b8a;
        margin-bottom: 20px;
    }
</style>

<script>
let googleVoice = null;
let codeMap = {}; // from JSON

function loadVoices() {
    const voices = speechSynthesis.getVoices();
    googleVoice = voices.find(v => v.name.includes("Google") && v.lang === "zh-TW") 
                || voices.find(v => v.lang === "zh-TW");
}
speechSynthesis.onvoiceschanged = loadVoices;

function sayParts(name) {
    const part1 = new SpeechSynthesisUtterance(name);
    part1.lang = 'zh-TW';
    part1.rate = 1.1;
    if (googleVoice) part1.voice = googleVoice;

    const part2 = new SpeechSynthesisUtterance("報到成功");
    part2.lang = 'zh-TW';
    part2.rate = 1.0;
    if (googleVoice) part2.voice = googleVoice;

    speechSynthesis.speak(part1);
    speechSynthesis.speak(part2);
}

function normalize(str) {
    return str.trim().toLowerCase();
}

function checkin() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');

    const inputCode = normalize(document.getElementById("check").value);
    const name = codeMap[inputCode];

    if (name) {
        document.getElementById("check_list").value += `[${h}:${m}]${name}\n`;
        document.getElementById("hidden_list").value += `[${h}:${m}],,,,,${name}\n`;
        document.getElementById("who_check").innerHTML = `${h}:${m}<br>${name}`;
        sayParts(name);
    } else {
        document.getElementById("who_check").innerHTML = "<font color='red'>⚠️ 查無此代號</font>";
    }

    document.getElementById("check").value = "";
}

function clipboard() {
    const hidden = document.getElementById("hidden_list");
    hidden.style.display = "block";
    hidden.select();
    document.execCommand("copy");
    hidden.style.display = "none";
    alert("已複製到剪貼簿！");
}

function loadJSON() {
    fetch("codes.json")
    .then(res => res.json())
    .then(data => {
        codeMap = data;
    }).catch(err => {
        alert("載入代號資料失敗：" + err);
    });
}

window.onload = loadJSON;
</script>
</head>

<body>
    <h2>簽到系統</h2>
    <p>請輸入編號</p>
    
    <div id="who_check"></div>
    <input id="check" type="text" placeholder="請輸入代號" onkeyup="if(event.keyCode==13) checkin();"><br><br>

    <input type="button" value="複製簽到名單" onclick="clipboard();"><br><br>
    <textarea id="check_list" rows="10" readonly></textarea>
    <textarea id="hidden_list" style="display:none;" readonly></textarea>
</body>
</html>
